<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>La Santísima Tarot — Acortador</title>
<style>
:root{--gold:#d4af37;--bg1:#0f0b14;--glass:rgba(255,255,255,0.03)}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,Arial;background:
linear-gradient(135deg,#2b0a2a 0%,#0f0b14 100%);color:#f3efe6;display:flex;align-items:center;justify-content:center;height:100vh;padding:20px}
.card{width:420px;max-width:100%;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.12));
border-radius:14px;padding:20px;border:1px solid rgba(212,175,55,0.06);box-shadow:0 10px 30px rgba(0,0,0,0.6)}
.header{display:flex;gap:12px;align-items:center}
.logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,rgba(212,175,55,0.14),rgba(212,175,55,0.06));display:flex;align-items:center;justify-content:center;color:var(--gold);font-weight:700;font-size:24px}
h1{margin:0;color:var(--gold);font-size:18px}
.lead{margin:0;font-size:13px;color:#dcd6c7}
.form{margin-top:14px;display:grid;gap:10px}
input,textarea,select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.01);color:#fff}
textarea{resize:vertical;height:70px}
.row{display:flex;gap:8px}
.btn{flex:1;padding:10px;border-radius:8px;border:none;background:var(--gold);color:#111;font-weight:700;cursor:pointer}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:#ffd}
.result{margin-top:12px;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);display:none}
.short{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.shortbox{flex:1;background:rgba(255,255,255,0.03);padding:8px 10px;border-radius:8px;font-size:13px;word-break:break-all}
.actions{display:flex;gap:8px}
.small{padding:8px 10px;border-radius:8px;border:none;cursor:pointer}
.small.copy{background:#ffeb3b}
.small.open{background:#03a9f4}
.list{margin-top:12px;max-height:120px;overflow:auto;padding-right:6px}
.item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-bottom:1px solid rgba(255,255,255,0.02)}
.meta{font-size:12px;color:#d7d7d7}
.hint{font-size:12px;color:#d0cbb0;margin-top:10px}
</style>
</head>
<body>
<div class="card" role="main">
  <div class="header">
    <div class="logo">☥</div>
    <div>
      <h1>La Santísima Tarot</h1>
      <p class="lead">Acortador de enlaces — genera accesos directos a WhatsApp</p>
    </div>
  </div>

  <div class="form">
    <input id="alias" placeholder="Alias (ej: consulta)" />
    <textarea id="message" placeholder="Mensaje inicial para WhatsApp (opcional)"></textarea>
    <input id="number" value="2231164369" placeholder="Número WhatsApp (solo dígitos)" />
    <div class="row">
      <button id="create" class="btn">Crear enlace</button>
      <button id="clear" class="btn ghost">Limpiar</button>
    </div>
  </div>

  <div id="result" class="result" aria-live="polite">
    <div class="short">
      <div id="shortbox" class="shortbox"></div>
      <div class="actions">
        <button id="open" class="small open">Abrir</button>
        <button id="copy" class="small copy">Copiar</button>
        <button id="delete" class="small ghost">Eliminar</button>
      </div>
    </div>
    <div id="hint" class="hint"></div>
  </div>

  <div id="list" class="list"></div>
  <div class="hint" style="margin-top:8px">Para que el enlace funcione como <strong>https://tuusuario.github.io/#/alias</strong>, sube este archivo a un repo llamado <code>tuusuario.github.io</code>.</div>
</div>

<script>
// BASE limpio (origin solo)
const BASE = window.location.origin;

// refs
const aliasEl = document.getElementById('alias');
const msgEl = document.getElementById('message');
const numEl = document.getElementById('number');
const createBtn = document.getElementById('create');
const clearBtn = document.getElementById('clear');
const result = document.getElementById('result');
const shortbox = document.getElementById('shortbox');
const openBtn = document.getElementById('open');
const copyBtn = document.getElementById('copy');
const delBtn = document.getElementById('delete');
const hint = document.getElementById('hint');
const list = document.getElementById('list');

function sanitize(a){return String(a||'').trim().toLowerCase().replace(/[^a-z0-9\-]/g,'').replace(/^\-+|\-+$/g,'');}
function buildWhats(num,msg){
  const clean = String(num||'').replace(/\D/g,''); if(!clean) return null;
  const m = encodeURIComponent(String(msg||'').trim());
  return m ? `https://wa.me/${clean}?text=${m}` : `https://wa.me/${clean}`;
}

function loadList(){
  list.innerHTML='';
  const keys = Object.keys(localStorage).filter(k=>k.startsWith('short_')).sort();
  if(!keys.length){ list.innerHTML='<div class="hint">No hay alias creados aún.</div>'; return; }
  keys.forEach(k=>{
    const alias = k.replace('short_','');
    const target = localStorage.getItem(k);
    const div = document.createElement('div'); div.className='item';
    div.innerHTML = `<div><a href="${BASE}/#/${alias}" target="_blank">${BASE}/#/${alias}</a><div class="meta">${target}</div></div>
      <div>
        <button data-a="${alias}" data-action="open" class="small">Abrir</button>
        <button data-a="${alias}" data-action="copy" class="small copy">Copiar</button>
        <button data-a="${alias}" data-action="del" class="small ghost">Eliminar</button>
      </div>`;
    list.appendChild(div);
  });
}

createBtn.addEventListener('click', ()=>{
  const alias = sanitize(aliasEl.value);
  const number = numEl.value.trim();
  const message = msgEl.value || '';
  if(!alias){ alert('Alias inválido.'); aliasEl.focus(); return; }
  if(!/^[0-9]+$/.test(number)){ alert('Número inválido'); numEl.focus(); return; }
  if(localStorage.getItem('short_'+alias)){ alert('Alias ya existe'); aliasEl.focus(); return; }
  const target = buildWhats(number,message);
  localStorage.setItem('short_'+alias, target);
  const short = `${BASE}/#/${alias}`;
  shortbox.textContent = short;
  shortbox.setAttribute('data-short', short);
  result.style.display='block';
  hint.textContent = `Redirige a: ${target}`;
  openBtn.setAttribute('data-short', short);
  copyBtn.setAttribute('data-short', short);
  delBtn.setAttribute('data-alias', alias);
  loadList();
});

copyBtn.addEventListener('click', ()=>{
  const s = copyBtn.getAttribute('data-short') || shortbox.getAttribute('data-short');
  if(!s) return alert('No hay enlace');
  navigator.clipboard.writeText(s).then(()=>{ copyBtn.textContent='Copiado ✔'; setTimeout(()=>copyBtn.textContent='Copiar',1500); });
});

openBtn.addEventListener('click', ()=>{
  const s = openBtn.getAttribute('data-short') || shortbox.getAttribute('data-short');
  if(!s) return alert('No hay enlace');
  window.open(s,'_blank');
});

delBtn.addEventListener('click', ()=>{
  const a = delBtn.getAttribute('data-alias');
  if(!a) return;
  if(!confirm('Eliminar alias '+a+'?')) return;
  localStorage.removeItem('short_'+a);
  result.style.display='none';
  loadList();
});

list.addEventListener('click', (ev)=>{
  const b = ev.target.closest('button'); if(!b) return;
  const a = b.getAttribute('data-a'); const action = b.getAttribute('data-action');
  if(action==='open'){ window.open(`${BASE}/#/${a}`,'_blank'); }
  else if(action==='copy'){ navigator.clipboard.writeText(`${BASE}/#/${a}`); b.textContent='Copiado ✔'; setTimeout(()=>b.textContent='Copiar',1500); }
  else if(action==='del'){ if(confirm('Eliminar '+a+'?')){ localStorage.removeItem('short_'+a); loadList(); } }
});

clearBtn.addEventListener('click', ()=>{ aliasEl.value=''; msgEl.value=''; numEl.value='2231164369'; result.style.display='none'; });

function checkRedirect(){
  const h = window.location.hash;
  if(h && h.startsWith('#/')){ const alias = h.slice(2); const target = localStorage.getItem('short_'+alias); if(target){ window.location.href = target; } }
}
loadList(); checkRedirect();
</script>
</body>
</html>
